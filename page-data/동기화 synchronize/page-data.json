{"componentChunkName":"component---src-templates-post-template-tsx","path":"/동기화 synchronize/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>Thread pool</h2>\n<hr>\n<p>웹 서버가 사용자의 요청들을 처리하는 여러 방법 중에 <strong>Thread per request</strong> 환경을 보면<br>\n사용자의 Request 를 Queue 에 담아 논 후 Thread Pool 에서 사용이 끝난 후 반납된 Thread 에 해당 요청 작업을 수행 시키게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 764px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d6298ca88cf1f0438f3404babef63afd/2cbcd/thread_per_req.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbElEQVQoz5WSz07CQBDGt2Xb7tJWSFP6hwKlhCYSDEYuXuDCWQ6+Aok3E06cPPIaPoQP4Dv4KCaedT/TtS2lUdHDl5nZnfnt7O4QQsirYRiwLEtwzoVpWchiQsh/JHL7TjLHcRwxHA7h+z7CwIPrun8CTcIQN7MZbMaq0NIRVOcI42lZoChKDaJIqaoq4/vVCs+7HRilkqEqiqgCoRscXjeRBZRSqVNdRq0WHtZrXPb7xRrBWbsD026XSQWQcw7GmPQNg6E7SBH0RvCjEaLBWOaeByEeNxss0vQA7MYTuEEsFyjVJDCTruuwLBuaRqEbDHF6if7oAr1king8k/ktxnAVRXCazQOwruztsq40TSs7Lt6tvEVuU8/Dy36P2/n8GKjpDKxpo9FoSFgGrUPKA3N7nSS4WyzgmmZ1/+tT3GAositVCzP4d0A1//3Ncomn7RYd2xb5QYLUBvO48IcOTww3efsNekr5rBa1H5/hcfORS0UH+gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d6298ca88cf1f0438f3404babef63afd/a59e9/thread_per_req.webp 192w,\n/static/d6298ca88cf1f0438f3404babef63afd/0ca9f/thread_per_req.webp 384w,\n/static/d6298ca88cf1f0438f3404babef63afd/83502/thread_per_req.webp 764w\"\n              sizes=\"(max-width: 764px) 100vw, 764px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d6298ca88cf1f0438f3404babef63afd/3b721/thread_per_req.png 192w,\n/static/d6298ca88cf1f0438f3404babef63afd/66595/thread_per_req.png 384w,\n/static/d6298ca88cf1f0438f3404babef63afd/2cbcd/thread_per_req.png 764w\"\n            sizes=\"(max-width: 764px) 100vw, 764px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d6298ca88cf1f0438f3404babef63afd/2cbcd/thread_per_req.png\"\n            alt=\"Imgae\"\n            title=\"Imgae\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n<em>[그림1] Thread per request 에서의 처리 방식</em></p>\n<p>이러한 상황에서 여러 Thread 가 static 변수 등의 여러 Thread 와 공유하는 데이터가 존재하는<br>\nHeap 영역에 접근해서</p>\n<p><em>값의 수정이 일어 나게 되면</em></p>\n<p>과연 그 값의 수정은 개발자의 의도대로 정상 작동할까?</p>\n<h2>의도대로 작동하지 않는 코드</h2>\n<hr>\n<p>우선 예시로 여러 개의 Thread 가 수행되고 있는 환경에서 어떤 문제가 생길 수 있을까</p>\n<p>통장 잔고를 확인 후 출금하고자 하는 금액(100~300 random) 보다 클 경우 출금 후\n잔여급액을 출력하는 코드를 통해 발생하는 문제를 알아보자.</p>\n<ol>\n<li>우선 아래와 같이 withdraw 함수를 수행하는 Accout class 를 작성해준다.</li>\n</ol>\n<p>withdraw 함수에서 잔여 금액 확인 후 조건을 만족 할 경우 Thread sleep 이후 잔여 금액에서 차감시켜 줍니다.\n(Thread 를 의도적으로 sleep 시켜 Context Switching 이 발생하도록 작성해 준다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadStaticAccount</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> remainMoney <span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getRemainMoney</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> remainMoney<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">withdraw</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//해당 시점에서 remainMoney 값을 메모리에서 읽어온 시점에서는 아래 조건이 true 이나</span>\n        <span class=\"token comment\">//Thread 의 Context Switching 이 발생함에 따라 데이터 값이 변동 될 수 있다.</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>remainMoney <span class=\"token operator\">>=</span> money<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">try</span><span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// Thread 의 처리 속도가 빨라서 sleep 을 줘서 Context Switching 이 발생하도록</span>\n                <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            remainMoney <span class=\"token operator\">-=</span> money<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Not enough money\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ol start=\"2\">\n<li>Thread 를 구현하기 위한 TaskRunnable class 를 구현해 준다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TaskRunnable</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Runnable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">ThreadStaticAccount</span> threadStaticAccount <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadStaticAccount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>threadStaticAccount<span class=\"token punctuation\">.</span><span class=\"token function\">getRemainMoney</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">int</span> money <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n            threadStaticAccount<span class=\"token punctuation\">.</span><span class=\"token function\">withdraw</span><span class=\"token punctuation\">(</span>money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"remain Volume: \"</span> <span class=\"token operator\">+</span> threadStaticAccount<span class=\"token punctuation\">.</span><span class=\"token function\">getRemainMoney</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"3\">\n<li>new TaskRunnable() 을 통해 Runnable 객체를 생성한 후 2개의 Thread 를 start 시켜준다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MultiThreadSyncTest</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Runnable</span> run <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TaskRunnable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>run<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>run<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>의도한 코드에 의하면 어떤 결과가 나와야 되는가?</p>\n<p>ThreadStaticAccount 의 withdraw() 메서드 실행시 잔여금액(remainMoney)을 확인 후<br>\n출금하고자 하는 금액(money)보다 충분하다는 조건을 통과한 후에 해당 금액을 차감한 양의 금액이 나와야 한다.<br>\n(잔여금액을 확인 후 출금하고자 하는 금액보다 충분하다는 조건을 만족했기에)</p>\n<p>하지만 결과는 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">remain <span class=\"token class-name\">Volume</span><span class=\"token operator\">:</span> <span class=\"token number\">700</span>\nremain <span class=\"token class-name\">Volume</span><span class=\"token operator\">:</span> <span class=\"token number\">700</span>\nremain <span class=\"token class-name\">Volume</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span>\nremain <span class=\"token class-name\">Volume</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span>\nremain <span class=\"token class-name\">Volume</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span>\nremain <span class=\"token class-name\">Volume</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span>\nremain <span class=\"token class-name\">Volume</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span>\nremain <span class=\"token class-name\">Volume</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\nremain <span class=\"token class-name\">Volume</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">100</span></code></pre></div>\n<p>어째서 위와 같은 경우가 발생하는가</p>\n<h2>Multi Thread 의 CPU 에서의 동작</h2>\n<hr>\n<p>우리가 작성한 코드 (User level) 은 메모리 영역에서 아래와 같이 올라간다</p>\n<p>JVM 환경은 user thread 와 os thread (kernel thread) 는 one to one 방식으로 매핑한다.</p>\n<p>위 말인 즉슨 JVM 환경에서는 Thread 스케줄링은 OS 에게 위임한다는 의미이다.</p>\n<p>따라서 아래와 같이 각각의 Thread 가 스케줄링 될 경우, 시점에 따라서 Heap 에서 공유되어 동기화화될 것이라\n믿었던 static 변수의 값이 이전 작업 Thread 에 의해 수정이 발생할 수도 있다는 것이다.</p>\n<p>eg. static 변수 int state 를 multi thread 환경에서 add() { state++; } 연산</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 759px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a004fffc0883610299af50b7dbf7ffb8/db779/thread_using_heap.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.541666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYUlEQVQ4y5VTPW/TUBR9tvP8ka86qR3XcUgdEqe0jRqniYpIhcpQFVwaqVClUgda0QGhDh0QS4cGCYYwhCn8AgL/gz/Ab2ApOwtCYshB7zkxFOjAcHTv9b3v6Precwkh5DshBISQ8cRyiKIEURAgMF8QEIvFQIjAc8Ik5vmwZvr2B/kXGYPj5EFVNYrzTh6yTLnPrO04+OPNlCNyxrKahBKfAVVTMGZNLMzNoWwYqBgGbDMHNalD0dKgWhqFnIWFXA6eacLNZses2wnXhFAQUG11sHb3CWobh1hZXMOn589w0X+Nzy96uN9aR/nWPtrBU8y3dvFo/Q4uXr3El34fH09PkVKUsFNN02DbNp+Ju9TGjeY9lBtbqJZreLvfxej4GO+ODtFeqsNZ2sBiK4CzeBtbK6t4f3SED4+P8WZvD+l4PCSUJAmyLIezUTRQWYUksYGL4eBFMVySJCKVTEBVKGQqQaIxUE1jBCCTmukMo83lCy5sZx6ZrIF0Ko2q66JUKMDMZKDrGVybL8OyC0ikdBjZWSyUSnAsC7MzM1wNlwinUGQZiqLwzhKJBLcCgxBCYvLhfigpmVJILH8VIQMbg3j5N/4Hv2RjmiaKxSI8z+NW1/Wo0LIsLC8vo16v8zyLK5UKfN/n39li/yLsdrs4Pz/H2dkZer0eNjc3I0Lfb2D3wUME29sIggCNRgPbQYDOzg46nc642WxGOoxUfnJygsFggOFwiNFohIODg8nCCK6XPdRXb6LiVXlnVa+KNd+HX6vx2HXd6FK+XnV+v4NJSFHChamqymMmNzmMx5Tys/z2E2ZfS5wAtcrRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a004fffc0883610299af50b7dbf7ffb8/a59e9/thread_using_heap.webp 192w,\n/static/a004fffc0883610299af50b7dbf7ffb8/0ca9f/thread_using_heap.webp 384w,\n/static/a004fffc0883610299af50b7dbf7ffb8/8bce2/thread_using_heap.webp 759w\"\n              sizes=\"(max-width: 759px) 100vw, 759px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a004fffc0883610299af50b7dbf7ffb8/3b721/thread_using_heap.png 192w,\n/static/a004fffc0883610299af50b7dbf7ffb8/66595/thread_using_heap.png 384w,\n/static/a004fffc0883610299af50b7dbf7ffb8/db779/thread_using_heap.png 759w\"\n            sizes=\"(max-width: 759px) 100vw, 759px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a004fffc0883610299af50b7dbf7ffb8/db779/thread_using_heap.png\"\n            alt=\"thread using heap memory on cpu\"\n            title=\"thread using heap memory on cpu\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n<em>[그림2] Cpu 관점에서 Thread Context switching 과정의 Heap memory 데이터 연산</em></p>\n<h2>JVM 환경에서의 동기화 해결책</h2>\n<hr>\n<p>[그림2] 싱황을 고려하여 앞서 살펴본 코드예제에서\nstatic 변수를 의도대로 참고하기 위해선 값을 유지해야하는 발생하는 메서드에 synchronized 를 선언해 줌으로써 같은 상황을 방지 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadStaticAccount</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">void</span> <span class=\"token function\">withdraw</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>remainMoney <span class=\"token operator\">>=</span> money<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>synchronized 키워드를 통해 Thread 간의 Context switching 이 발생하여 Data 의 안정성과 신뢰성을\n보장할 수 있는 Thread-safe 한 환경을 만들어 줄 수 있다.</p>\n<h2>Thread-safe 사용 예: StringBuilder 와 StringBuffer</h2>\n<p>해당 동기화 개념이 실제로 쓰이는 사례 중 StringBuilder 와 StringBuffer의 예시가 있다.</p>\n<p>공식 문서 확인 시 StringBuffer 는 Thread safe 하다 라고 나와 있는 것이</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 563px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b7d22bcf1c3b114fbd228071c98303ff/e80ce/StringBuffer_ref.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.854166666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABnUlEQVQoz5WT2W7bMBBF9f9fUqDfUaCPLZIutmNZomRrI8VNW+LIpyCdBn4KnAGONCTEO3MHVNL3PaIocM6zPL8wzQvjNLOuKyEulwufiaSVit+bPWle8GeX8uPXhoe/O4Zxehf8jGgSutJ2QPYW64fY2W13t4L3CCfzslA3DVmeU5QlQuS0bcPlTfR/3Ip/ROK9J8sF6SEjFwW5KNmnB05VHWcaWD9jOTzcMCG1w7gBZRy99fi3PaUtwcX5fL6LZBwHvLfM00jIr2uHtQalJFr3rOtr8Pw+349I2s6w2WYUR4k4SWRvsM6jjUWqHtlrxnnh/LreZ9nr71T5F9ryK6p7pOkMbSfppMJYS93KSLhe1lr84Alzn5fnyDAEV2Pcc86RaPmA7r7xMv1kHo84d7UcPgj2g+XwNkYTfoIwikC4p34YMcbEQlrrmCdSWQ7ZCSFqhCgRhaAsy0iWZVFEG804XQ8HnLOxUMA6G9ehYBBOVC9J0yee9rvIdreNQsfTMYoqpeLBpmli3nUdUkqMNbRtS1WdqOuapm2oqop/HBScHAvyETcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b7d22bcf1c3b114fbd228071c98303ff/a59e9/StringBuffer_ref.webp 192w,\n/static/b7d22bcf1c3b114fbd228071c98303ff/0ca9f/StringBuffer_ref.webp 384w,\n/static/b7d22bcf1c3b114fbd228071c98303ff/1b3b6/StringBuffer_ref.webp 563w\"\n              sizes=\"(max-width: 563px) 100vw, 563px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b7d22bcf1c3b114fbd228071c98303ff/3b721/StringBuffer_ref.png 192w,\n/static/b7d22bcf1c3b114fbd228071c98303ff/66595/StringBuffer_ref.png 384w,\n/static/b7d22bcf1c3b114fbd228071c98303ff/e80ce/StringBuffer_ref.png 563w\"\n            sizes=\"(max-width: 563px) 100vw, 563px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b7d22bcf1c3b114fbd228071c98303ff/e80ce/StringBuffer_ref.png\"\n            alt=\"Imgae\"\n            title=\"Imgae\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n<em>[그림3] StringBuffer 공식 문서 (<a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/StringBuffer.html\" target=\"_blank\" rel=\"nofollow\">https://docs.oracle.com/javase/7/docs/api/java/lang/StringBuffer.html</a>)</em></p>\n<p>위의 동기화 개념이 적용 된 것이다.</p>\n<p>실제 소스 코드에서도 synchronized 를 선언해 줌으로써 StringBuffer 가 동기화에 있어서 보장해주고 있다는 것을 확인 할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ac97761afd9989e8eaa68477c1011175/46352/stringBuffer_code.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.72916666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAABwElEQVQ4y42UW47bMAxFvZxafFOyE8fTovvf1C2kpE46caf9OCBpUMQlKXkiYeQtkHvAr47cHfUjUPc4bKwGDRmIC8T4GRuDiFBKGXYSIUQwMgW1KqIFvAUsFOIMFh7JZX6hfPIfxbqdmAq2qvj5ccX324plXXHZdkRWMMuR/C8OhUQMUYN5ovvzt/lcyfyu6pWnQiZYE2gVeNMxL+8sn60OPy4Ga3rM06qC+EUhCyE3R+2L2Xzwu2i3vYA/7BEvCk0Z9GJ/ttwVrgZbDFoVtijYCNy3x+V+4BW6W9a+MHpvWZXRVsWyGlpTZAtkS0QNiOjpvP42v3vLVHBJxY/9gv26YF2vWC83ZF1g7v+15decqYwtOyIb+EtF74fPmEwJNQuEZ1ApYCL0zYvI8GnEfKrmtKArYU1Cc0IqIZTQUpHhw/d+R9Uwl/ltXqcthxG2hVCd4HKnhSDDECYwYag43BwqMrr4UmFvT4Wg/MSVoSqQ3npvmbov48BcCuZ5PmVcm3DCtpah0B4Kwxit/yz6S1CBZ8KjE0hjuPt46/1bZN59jzH3qavohQ66QmOkyyiswjDzgZqNHFV9xgOHqo3l/QKI4ulcZE2iwQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ac97761afd9989e8eaa68477c1011175/a59e9/stringBuffer_code.webp 192w,\n/static/ac97761afd9989e8eaa68477c1011175/0ca9f/stringBuffer_code.webp 384w,\n/static/ac97761afd9989e8eaa68477c1011175/dc9b9/stringBuffer_code.webp 768w,\n/static/ac97761afd9989e8eaa68477c1011175/e2c2f/stringBuffer_code.webp 1152w,\n/static/ac97761afd9989e8eaa68477c1011175/f3efb/stringBuffer_code.webp 1536w,\n/static/ac97761afd9989e8eaa68477c1011175/6a898/stringBuffer_code.webp 1542w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ac97761afd9989e8eaa68477c1011175/3b721/stringBuffer_code.png 192w,\n/static/ac97761afd9989e8eaa68477c1011175/66595/stringBuffer_code.png 384w,\n/static/ac97761afd9989e8eaa68477c1011175/fe486/stringBuffer_code.png 768w,\n/static/ac97761afd9989e8eaa68477c1011175/d2d74/stringBuffer_code.png 1152w,\n/static/ac97761afd9989e8eaa68477c1011175/e8464/stringBuffer_code.png 1536w,\n/static/ac97761afd9989e8eaa68477c1011175/46352/stringBuffer_code.png 1542w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ac97761afd9989e8eaa68477c1011175/fe486/stringBuffer_code.png\"\n            alt=\"Imgae\"\n            title=\"Imgae\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n<em>[그림4] StringBuffer source code</em></p>\n<p>여기까지 Multi Thread 환경에서 발생할 수 있는 문제점과 이를 해결하기 위한 synchronized 키워드를 정리하였습니다.</p>\n<p>Trade-off 는 synchronized 사용시 Thread-safe 를 보장하지만, synchronized 메서드가 많을 수록 멀티스레드는 병목현상을 겪게 됩니다.</p>\n<p>이는 멀티 스레드를 사용하지만, 싱글 스레드처럼 동작한다는 것입니다.</p>\n<p>따라서 작성하고자 하는 코드의 목적에 적합하게 사용해야 합니다.</p>\n<br>\n<br>\n<p>reference</p>\n<blockquote>\n<ul>\n<li><a href=\"https://product.kyobobook.co.kr/detail/S000001032977\" target=\"_blank\" rel=\"nofollow\">자바 성능 튜닝 이야기 - static 제대로 한번 써보자</a></li>\n<li><a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/StringBuffer.html\" target=\"_blank\" rel=\"nofollow\">Java String Buffer</a></li>\n</ul>\n</blockquote>\n<blockquote>\n<p>부족한 글 읽어주셔서 진심으로 감사드리며, 잘못된 부분이나 개선점은 무심하게라도 알려주시면 너무 감사하겠습니다.</p>\n</blockquote>","frontmatter":{"title":"Multi Thread 환경에서 동기화(Synchronized)의 필요 이유","summary":"Multi Thread 환경에서 Thread 는 어떻게 Cpu 에서 동작하며, 공유자원을 사용하지는지, 동기화는 무엇이며 무엇을 해결하는지 알아보자","date":"2023.08.20.","categories":["Java","OS"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADSElEQVQ4yyWSW28aBxCF+QV9ScAQB1+4LGa5LBfvLizLLqzBYGC52QZsx6axY6chtVvZktumSftSq43UtFXlSm6rJpHlCqdV1P7Dr4I+jDQzD985ozOO+XgSf3KZYEomLGeRNJNk3iJllinU19ErLaRcEcVao7X1IXJhlYiaI5bNI6QUslYFn5TCHRIRUjIOKWeiFFfRyzWMapNyu0drsEezt8vJ6TMOR2dU2n0Gw0NefH1Bf/eAxsY21XYPv5SmULWnwEBSRsoZOORCCbPapL6xzfBwxGdPRnwzOuLb519xdXnFm9/+4Oz8Bb9cXnF7fcPLlz/y+PiMo6ef0B8eUtvYRi2WaQ92kbQ8jljOIlu2qW7scDx8wJd1g9FWj/H4HW9eX/P25m9uxu+5efcP47/+5fr2PT//+prb8Z/8/vaGV5dXXHz/A9+9+onZUBhHPGdRXmtglcoUCyb1nIqSyVJqdzn56AkPR+ecPLtg/9Pn7J98wcenn7N38IjdvQfYnQ72eofmYIfaeo/7oSUcsmGxulbnrN+mb+l4hBBun48P5hYJh0XUfAnRqBPSKySKNlmjSEiS0AyTVEZDNQtUWptE5Az3ggIOUc6wYprsWHm0RBxPIMhiVEKMSyQmpRWIth4RMhuIpXUy9QF5U0dUVEr2xOGARrdHOC0z4w/gmI8lWFZU5HQaMZFkPhJjTowRjCUw7S06Ww+Ryl1ynSGN7SPy9hZWp4tSqeIWlvAn0qR0g6CUxLnow+EJiXij0jT6xWgcjxifulvKrqBvHzMYPkYotLCGpwyfnpPSV5hRKki1PslKndlwZPqDXjHKTED4HzhRcvmDuHwB3Jky8+k8XtkiaB9Qqncxi2XE9iFKd597RguXZuNMmEiVdYp2B188gSu4hGeSspBITVU8whJuIYxbLeHK1pjN23iru3RabdKawWxxk/tWD0++jVtv415ewRnTiFlNjJo9hTr9Ag5vOMJCND6Funx+ZkIiLq3GXaOLW6vhjSa4E9O4q1Rxak2c6hrOSZ8u4Ywo3BFlhFwVxSrji0s4JqfOBILThCY1mefUFQKlTXxmg4W0jk+18Bc7+Ke7Ngv5Jot6g3nZYiFt4JVLBNQikYzOf/qB0TaDbCyHAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/529180095f316c31e09416bcc12ab7b9/18f49/Sync_thum.png","srcSet":"/static/529180095f316c31e09416bcc12ab7b9/aaef4/Sync_thum.png 204w,\n/static/529180095f316c31e09416bcc12ab7b9/6884d/Sync_thum.png 407w,\n/static/529180095f316c31e09416bcc12ab7b9/18f49/Sync_thum.png 814w","sizes":"(min-width: 814px) 814px, 100vw"},"sources":[{"srcSet":"/static/529180095f316c31e09416bcc12ab7b9/a6bdf/Sync_thum.webp 204w,\n/static/529180095f316c31e09416bcc12ab7b9/df0a2/Sync_thum.webp 407w,\n/static/529180095f316c31e09416bcc12ab7b9/d45cf/Sync_thum.webp 814w","type":"image/webp","sizes":"(min-width: 814px) 814px, 100vw"}]},"width":814,"height":543}},"publicURL":"/static/529180095f316c31e09416bcc12ab7b9/Sync_thum.png"}}}}]}},"pageContext":{"slug":"/동기화 synchronize/"}},"staticQueryHashes":[]}