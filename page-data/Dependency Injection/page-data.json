{"componentChunkName":"component---src-templates-post-template-tsx","path":"/Dependency Injection/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>Overview</h2>\n<hr>\n<p>의존성이란 프로그래밍을 통해 product 를 개발할 때 하나하나의 분리된 기능들이 상호 의존관계를 가지며 개발되는 과정에서의 관계를 의미합니다.</p>\n<p>홈 화면에 진입시 홈 화면에 필요한 데이터가 무엇인지 판단하는 기능에 의존하게 되고, 필요한 데이터를 서버에 요청하는 기능에 의존하게 됩니다.</p>\n<p>이렇듯 상호 의존성이 생기며 개발되는 상황에서 생기는 문제점이 무엇이며, 해당 문제점을 해결하기 위해서 의존성 주입이 하는 역할이 무엇인지 이해해 보도록하겠습니다.</p>\n<h3>의존성 주입</h3>\n<p>Dependency Injection (이하  DI), 즉 의존성 주입에 대해 해당 concept 을 접하게 되는 경로를 되집어 가보면 그 의미가 조금은 더 명확해진다.</p>\n<p>나의 경우 DI 를 제대로 이해해야겠다고 느끼게 된 계기는 <strong>CleanArchitecture</strong> 의 도입을 고려하면서이다.</p>\n<p>그 의미는 CleanArchitecture 가 이루고자하는 의존성 분리 향한 과정에서 DI 가 빈번하게 사용됨이고, 의존성 주입(DI) 는 의존성의 분리를 도와준다는 것이다 .</p>\n<p>또 의존성 분리는 테스트 코드 작성을 고려할 때도 자주 접할 수 있는데, 이는 테스트 환경 즉, Mock 데이터로 test 하기 적합한 형태로 만드는 것을 DI 가 도와준다는 말이 될 것 같다.</p>\n<p>따라서 의존성 주입이란 <strong>의존성 분리</strong>와 <strong>테스팅</strong>을 도와줄 수 있다는 점은 분명한거 같다.</p>\n<h2>DI in playground</h2>\n<hr>\n<h3>강한 의존성을 어떤 문제를 발생시키는가</h3>\n<p>우선 강한 의존성이란 하나의 클래스가 다른 클래스를 구체타입으로 가지고 있는 상태를 의미 합니다.</p>\n<p>구체타입으로 가지고 있다는 것은 다음과 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token comment\">// MARK: 상위 클래스</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodRepository</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">getFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Food</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Food</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// MARK: 위의 클래스를 의존하는 클래스</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodRestaurant_A</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> foodFactory <span class=\"token operator\">=</span> <span class=\"token class-name\">FoodFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">deliveryFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        foodFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodRestaurant_B</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> foodFactory <span class=\"token operator\">=</span> <span class=\"token class-name\">FoodFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">deliveryFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        foodFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>현 상태는 FoodRepository_A 와 FoodRepository_B가 FoodFactory를 직접 생성하여 사용하는 상태이며, 해당 상태를 의존성이 높은 상태라고 합니다.</p>\n<p>이런 강한 의존성을 가지는 상태는</p>\n<ol>\n<li>\n<p>FoodFactory 에서 수정이 생기게 되면(getFood() 가 변경되는 등)  FoodRepository_A 와 FoodRepository_B 모두에서 FoodFactory의 메서드를 직접 사용하기에 오류가 발생하여, FoodFactory 를 의존하는 (현 상태에서는 인스턴스를 생성하는) 부분을 모두 찾아서 수정해주어야 하기 때문에, 코드 수정상의 복잡성이 생기는 문제를 야기 합니다.</p>\n</li>\n<li>\n<p>또한 위의 FoodFactory 를 테스팅 하기 위해 아래의 TestFoodFactory 로 변경하여 사용하고자 할 경우에도 FoodRepository 들은 각자 FoodFactory 를 직접 생성하여 사용하기 때문에, FoodFactory 를 의존하는 모든 클래스 내부의 생성부에서 수정해 주어야 한다.</p>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TestFoodRepository</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">getFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Food</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">Food</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// MARK: 위의 클래스를 의존하는 클래스</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodRestaurant_A</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> foodFactory <span class=\"token operator\">=</span> <span class=\"token class-name\">TestFoodFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// 변경해줘야해..</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">deliveryFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        foodFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodRestaurant_B</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> foodFactory <span class=\"token operator\">=</span> <span class=\"token class-name\">TestFoodFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 여기도 변경해줘야해..</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">deliveryFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        foodFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>따라서 의존하는 기능이 갖기를 기대하는 명확한 기능을 명시함과 동시에 변경가능한 기능에 유연하게 대처하기를 갈망하게 됩니다.</p>\n<h3>의존성 주입은 어떻게 해결 하는가</h3>\n<p>위의 문제를 이론적인 문제로 추상화하여 다시 접근하면</p>\n<ol>\n<li>의존하는 기능이 갖기를 기대하는 명확한 기능을 명시함</li>\n</ol>\n<p>위의 말을 듣고 protocol 이 떠오른다면…  그냥 떠올랐다 합시다.</p>\n<p>특정 기능을 추상화하여 의존성을 받고 있는 클래스의 메서드가 수정되거나하는 일을 방지해야 합니다. 이를 위히여 <code class=\"language-text\">Eatable</code> 이라는 protocol 을 생성하고, 이를 채택하는 형태로 구현하여 1. 과 같이 메서드의 사용하는 모든 곳을 수정하는 일을 방지할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">Eatable</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">getFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Food</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TestFoodRepository</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Eatable</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">getFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Food</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">Food</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li>변경가능한 기능에 유연하게 대처하기</li>\n</ol>\n<p>위를 위하여 클래스 내부에서 직접 생성하여 사용하는 것이 아닌 외부에서 의존하고자 하는 기능을 <strong>주입</strong>함으로서 해결 가능해 집니다 .</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token comment\">// MARK: 위의 클래스를 의존하는 클래스</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodRestaurant_A</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> foodFactory<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Eatable</span>\n\n\t\t<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">init</span><span class=\"token punctuation\">(</span>foodFactory<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Eatable</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>foodFactory <span class=\"token operator\">=</span> foodFactory\n\t\t<span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">deliveryFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        foodFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodRestaurant_B</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> foodFactory<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Eatable</span>\n\n\t\t<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">init</span><span class=\"token punctuation\">(</span>foodFactory<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Eatable</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>foodFactory <span class=\"token operator\">=</span> foodFactory\n\t\t<span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">deliveryFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        foodFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getFood</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위처럼 의존하고자 하는 기능에 대한 클래스를 주입 받는 형태로 구현하게 되면, 직접 특정 기능의 클래스를 생성하여 사용하지 않기에 <strong>기대되는 특정 기능을 가지고</strong> 있는 클래스(Eatable protocol 을 채택하는)로 바꿔서 주입하거나 (eg. testing 환경)하는 상황에서도</p>\n<p>사용하고자 하는 FoodRepository 들에 의존성을 주입하는 곳에서만 변경해주면 되기에 보다 가시적이고 유연하게 변경할 수 있게 됩니다.</p>\n<h2>DI in Action</h2>\n<h3>Condition</h3>\n<p>레스토랑 스크린에 음식 데이터를 그려주는 화면을 설계할 경우의 구현을 의존성 주입 없는 구현과 의존성 주입을 통한 구현으로 개선하는 상황을 통해 보다 product 환경, 더 나아가 CleanArchitecture 에서의 Usecase, Repository 에서 어떻게 사용되는지에 대한 이해도를 높여 봅시다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6de88f2f66e0d69ec92ce5f909cc0dd3/78d47/DI_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEC0lEQVQ4yx2Ua2+TBQCF+zeMH4xRFAZj67oOurfr9W27t/et9769rJe1pdvYxroxtnFZEZgGGOiICsOtiEaDLpho/GaQGE0EWfQLCAoMPzgGdMAiCBgeM37AOTnJc85R+LNm5KKNjh6JeJdEoksi22+nf7SN3hE3sS4RX8GKtcNEU7uaRq8aIaxDytho3+LCW3DgytnxF1205x0o2jJGAjmR+FYHmW0e0n0usgMuCoNOerdHSBUCqHW11Avr8cbcOOJ2Gr1N6GUjUlbClpEQUzakjIS7045CShrwpo1Ikc2IfhXuuEB2wEk038LMxydYWXnChYvz/HJxnqdPYPaTGXTtDehDAkqHEqVThcqloiWsw5oQUdR7Gugd6+GLuTnGdo9SOX2a4zNTuOObOXakzO0/L3P115/5e+F3/l3+iw+nxrGG1Ox9Z4zJ9ybpLGY5earCwPg2LFENivXOBvJ9OT6fOsSnH7zL+wfG2bdzCE9SYPJwmZXFBW7/Mc+NK/MsL97gyNsj2MMqvpz7DJ5DtfqAW7/9wM5yiTdbN6Ko86gJJv10x7z0pUMMpez05GRciRZ2jQ1w7rvzzJ39hrmzX3Ppx584eriMGFAye+ojHi6vcPfOMpfOn6F/OM8aaw2KWk8jkYyf/s4wA70p9vSEyOWSmBImJJuOkEmDVfk6NS+/hKFOid/RQr1TyXTlJM8eP6N67wH/LV6lPLGDV42voahx1pLKtjGQCrOtK8ueXJh8wkdToBmbKFCOCYzKSgZlI8ORVlqNm1hjeYPpyjTPnz5ncfEOpw7tI55qZ51Ug2KDYwN+2clQPkFpS4qxjMxgIY4xImA3qEiIm0lZ6tjVHSTjMCNqN1LvXst05QT/PHjEnaV7XDt3luGdXdS5N65SrscfaaUkWykk/GQCbuSoD8HbwMEjE9y6fpPrl6+wsHCT6tJtjh0/yhrDKy/q8+jhY6r37vPwxiXKE0PUttasQlEhd7gZDWjJh7zEJRPhgAtDRE/54DAH9shUIlq+3+7mzEiR0kg3DbZ1VE7PvEh4d6nKrQvfMr53KzWWtSgsCR2huJOcsQ7ZpsWpqcfrNNCetVHalSFVsvLVZB9HixrySTWDo0UsQTUnZ49TXbrPlcvXOPHWDuSEm1r7BhSelBFrWMAS0OOKmnFGzQQ7JVxJLV2lTnbv383E/iF27NvKgalxBkd78GX0RAsuAtk2xKAZjViLWqpD42tCofWpsUS1rE7QlTbhSpvx5ayEt9gw+Bsx+TcRyVmJF+zYZSOeDgOetAlbrAVRFl6YNAeaMcmrehGFPqjBFNFiixtwJE20ZS1EihKxbolWuRlTSE1bWo8U02KNCtgTOsSIllWdLtiMLihgCLVgXj2LDjP/AxDHqvks3vIyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6de88f2f66e0d69ec92ce5f909cc0dd3/a59e9/DI_1.webp 192w,\n/static/6de88f2f66e0d69ec92ce5f909cc0dd3/0ca9f/DI_1.webp 384w,\n/static/6de88f2f66e0d69ec92ce5f909cc0dd3/dc9b9/DI_1.webp 768w,\n/static/6de88f2f66e0d69ec92ce5f909cc0dd3/cf465/DI_1.webp 800w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6de88f2f66e0d69ec92ce5f909cc0dd3/3b721/DI_1.png 192w,\n/static/6de88f2f66e0d69ec92ce5f909cc0dd3/66595/DI_1.png 384w,\n/static/6de88f2f66e0d69ec92ce5f909cc0dd3/fe486/DI_1.png 768w,\n/static/6de88f2f66e0d69ec92ce5f909cc0dd3/78d47/DI_1.png 800w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6de88f2f66e0d69ec92ce5f909cc0dd3/fe486/DI_1.png\"\n            alt=\"Image\"\n            title=\"Image\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3>Implement without DI</h3>\n<p>의존성 주입이 없이 구현을 하게 되면 아래와 같이 구현될 겁니다 .</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodRepositoryImpli</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">get</span><span class=\"token punctuation\">(</span>onCompletion<span class=\"token punctuation\">:</span> <span class=\"token attribute atrule\">@escaping</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Food</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">let</span> url <span class=\"token operator\">=</span> <span class=\"token function\">URL</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">:</span> <span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n\t\t\n\t\t<span class=\"token keyword\">let</span> task <span class=\"token operator\">=</span> <span class=\"token class-name\">URLSession</span><span class=\"token punctuation\">.</span>shared<span class=\"token punctuation\">.</span><span class=\"token function\">dataTask</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> url<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> \n\t\t\t<span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> data <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">}</span>\n\t\t\t\n\t\t\ttask<span class=\"token punctuation\">,</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 위의 Repository 를 의존</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodViewController</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViiewController</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> <span class=\"token class-name\">FoodListener</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">FoodRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">FoodListener</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>onCompletion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> foods <span class=\"token keyword\">in</span> \n\t\t\t<span class=\"token comment\">// UI setup</span>\n\t\t\t<span class=\"token function\">configureUI</span><span class=\"token punctuation\">(</span>foods<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Implement with DI</h3>\n<ol>\n<li>우선 의존하고자 하는 기능에 대한 protocol 을 정의해 줍니다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">FoodReopsitory</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">get</span><span class=\"token punctuation\">(</span>onCompletion<span class=\"token punctuation\">:</span> <span class=\"token attribute atrule\">@escaping</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Food</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li>정의한 protocol 을 채택하는 Repository를 생성해 줍니다.</li>\n</ol>\n<p>이로 인해 해당 클래스를 의존하여 메서드를 사용하는 경우에 기대하는 메서드가 변경되거나 하는 경우를 방지할 수 있게 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodRepositoryImpli</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">FoodReopsitory</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">get</span><span class=\"token punctuation\">(</span>onCompletion<span class=\"token punctuation\">:</span> <span class=\"token attribute atrule\">@escaping</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Food</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">let</span> url <span class=\"token operator\">=</span> <span class=\"token function\">URL</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">:</span> <span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n\t\t\n\t\t<span class=\"token keyword\">let</span> task <span class=\"token operator\">=</span> <span class=\"token class-name\">URLSession</span><span class=\"token punctuation\">.</span>shared<span class=\"token punctuation\">.</span><span class=\"token function\">dataTask</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> url<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> \n\t\t\t<span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> data <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">}</span>\n\t\t\t\n\t\t\ttask<span class=\"token punctuation\">,</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"3\">\n<li>ViewController 부분에서 Repository 를 주입 받는 형태로 개선하여, FoodRespository protocol 을 채택하는 형태의 외부 클래스에 대해 유연하게 작동하도록 만들어 줍니다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token comment\">// 위의 Repository 를 의존</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodViewController</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViiewController</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> <span class=\"token class-name\">FoodListener</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">FoodRepository</span>\n\n\t<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">init</span><span class=\"token punctuation\">(</span>foodRepository<span class=\"token punctuation\">:</span> <span class=\"token class-name\">FoodRepository</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">FoodListener</span> <span class=\"token operator\">=</span> foodRepository\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">FoodListener</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>onCompletion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> foods <span class=\"token keyword\">in</span> \n\t\t\t<span class=\"token comment\">// UI setup</span>\n\t\t\t<span class=\"token function\">configureUI</span><span class=\"token punctuation\">(</span>foods<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 의존성을 주입받는 형태로 개선하게 되면, DI 를 조립해주는 DIFactory 에서</p>\n<p>FoodRespository protocol 을 상속하는 Mock (StubFoodRepositoryImpli) 에 대해서도 쉽게 변경이 가능해 집니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">StubFoodRepositoryImpli</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">FoodReopsitory</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">get</span><span class=\"token punctuation\">(</span>onCompletion<span class=\"token punctuation\">:</span> <span class=\"token attribute atrule\">@escaping</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Food</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">let</span> foods <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">Food</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\t\t<span class=\"token function\">onCompletion</span><span class=\"token punctuation\">(</span>foods<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//... DIFactory </span>\n<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">StubFoodRepositoryImpli</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">FoodReopsitory</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token comment\">// MARK: 테스팅 환경에 따른 분기 처리</span>\n\t<span class=\"token keyword\">let</span> isDevelopmentOrTest <span class=\"token operator\">=</span> <span class=\"token function\">getIsDevelopmentOrTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>    \n\t    <span class=\"token keyword\">if</span> isDevelopmentOrTest <span class=\"token punctuation\">{</span>\n\t        <span class=\"token keyword\">return</span> <span class=\"token class-name\">StubFoodRepositoryImpli</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t        <span class=\"token keyword\">return</span> <span class=\"token class-name\">FoodRepositoryImpli</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t    <span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>따라서 의존성 주입을 통해서</strong> 의존 상태가 느슨하게 개션함으로서</p>\n<ol>\n<li>변경에 대해 보다 보장된 안정성( protocol 을 채택함으로서 )</li>\n<li>내부에서 직접 생성하는 것이 아닌 특정 프로토콜을 채택하는 클래스를 주입받음으로 변경에 대한 유연성</li>\n</ol>\n<p>을 가질 수 있게 됩니다.</p>\n<blockquote>\n<p>부족한 글 읽어주셔서 진심으로 감사드리며, 잘못된 부분이나 개선점은 무심하게 라도 알려주시면 계신 방향으로 감사인사 드리겠습니다.</p>\n</blockquote>\n<p>reference</p>\n<ul>\n<li><a href=\"https://belief-driven-design.com/decouple-your-code-with-dependency-injection-77b8d39cc93/\" target=\"_blank\" rel=\"nofollow\">https://belief-driven-design.com/decouple-your-code-with-dependency-injection-77b8d39cc93/</a></li>\n<li><a href=\"https://ios-development.tistory.com/612\" target=\"_blank\" rel=\"nofollow\">https://ios-development.tistory.com/612</a></li>\n<li><a href=\"https://eunjin3786.tistory.com/115\" target=\"_blank\" rel=\"nofollow\">https://eunjin3786.tistory.com/115</a></li>\n</ul>","frontmatter":{"title":"Dependency Injection","summary":"의존성에 대한 이해와 의존성 주입 적용 이전의 상황과 이후에 해결한 점에 대한 이해를 통한 의존성 주입의 필요성 이해","date":"2022.09.21.","categories":["iOS"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE0UlEQVQ4y12U+U9UVxzF53/oL60/9ae2xrjAbG/ewLBIXdJKrKAVZRFnA4EBZtiHxWEfYBhAQEEGBsEBQTah4goiShA3TFSaqJFYY6NNExNTY9rYTzOPFq0/nNx3b+4995zv/b4jUxs7UBmOszqaOpHHNyLfW4KYUIkQW4oQU0hAdAFKUwdCshe1yfNh/8dnjR3IVJ8sKA0elPvslF57QuPDN7hvv6DpwWuyeidZF1WIaD2NkNKN+lPif0eZ/8N/i8rYgZDUhcLUhTrRQe2luzQsPMf1+G+OLDyj9MI91u+vQJs9ipDuQ8w4hZByArX5/6Sy1Ym5E03KCVSHehAMVRR3DlB86hJFV5fJb/aS33cRZUo72rwziNlDKMztaNL7EDMGpLP/CVuxbPIgHOpGk+5DmeYjNL0R96M/qbn/B6WzT6l//J6KW7+htnSgLZwkuPAsX27Ws0axg4AEN0Jqr8QhWfZbVSd1IaT1ImaeQrANE5TaSOFPN3HMPKF45inl15fJGplHleElrHqOdftK+WJ9KJ99rWHtLjtCag9CcrdUNtmKuhMr8m0DaPPHUecMszH5GLqEbCIjNxPwQzJqWxch1TMo88f4ZpuerQUnWSNEEZQ3hiajf6Wepk5kfv/+G/yLmpxRgvLH2Fo0QHjFJQ7kOkg/+B0qg5MQ9wLBDYuICfk8aAzHumstXyUeRWefQJPZLzn0O5Wt2rUOImQNkmiIx2SKJTk5nlxrAtsza9DqHUS0LrKhYBxv3re8c39O8I7daBwzaHOHEW2DCBaf1EqrhJqsEYLT2og1mlA4ZlGVTqOsW0QsGUdjKEPnfYG8ao7wLWFsCwtkXc45dGXTiLkjiLbTaCw+qY4fEQ6jtXiIMlvRlU8RWnmZ0Pp5wqvOoTfHsqekme/NNsTog0SkOolMryDMehyxYEJS+IHQ338WH2LOGcTU4+w2phFUfpWQ6ll0zqvo6heILO0hJt9JdL6LPfYGonJq2ZlZxY+JBoTsIbRZgys1lCybu1AYjhFoaEUXbychOoxNhiYU6V50lVck0iDXLUT3PUTXHcSam2iqbiAvmiZu305U5hZU1lFJlF+cTKHvQJNQRNGFe5RNLVE8cZPqK0vsP9xEgKWbUOc1dBWXJYRUTiHaR9Gm1LMtr404k56t5mK08YUExtWiTvIiC4hrISKtGtf8MtW3XtG8DM0PXpPsmUCe6iGkfJogx3kJuvIrbDK4yRq+xrFfoGHpHW1P39P68HeUe2woDB5k8oSjBJvKqPH2UTI2j2PuOS5vP6bmAdRWH0FFk2gLJyQEFZ8n0NiA0e3FOT6H+/F77CPXqb1wm+CkOuSJbcgC4lvZnn2E+p/fUn7jVwrO3ce19JbsM3dRpXpXwsDfGrkj0l8UoHeT0uKj8eId7FOPyO05i2tynghbO/IDbcjkB9rZklFP3eJLnHde4bz9koalN1j6ZlCY2hBtQ2isA4h+2IZQJLoomXlCywtoevQXzc+QsMXWtkKoNnYi3+9EiCtCHWtHuTcX8cBhBH0tqmQvmrSTCBJ60Vj6kSc2ElfXjW1wlrTei1h8l8nsn0ZrrEep94eDFIydKPWeVfhfXmXsXMk5P5K6VqEyedgU42Tjbgfro4rZEF1CQEwVysSjUsD+A5Ibw3gG+q+zAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/2119932e4dcc6609db1aab6b2f265787/aef42/DI_thum.png","srcSet":"/static/2119932e4dcc6609db1aab6b2f265787/14dd5/DI_thum.png 125w,\n/static/2119932e4dcc6609db1aab6b2f265787/5add7/DI_thum.png 250w,\n/static/2119932e4dcc6609db1aab6b2f265787/aef42/DI_thum.png 500w","sizes":"(min-width: 500px) 500px, 100vw"},"sources":[{"srcSet":"/static/2119932e4dcc6609db1aab6b2f265787/2c9be/DI_thum.webp 125w,\n/static/2119932e4dcc6609db1aab6b2f265787/0b151/DI_thum.webp 250w,\n/static/2119932e4dcc6609db1aab6b2f265787/33dd0/DI_thum.webp 500w","type":"image/webp","sizes":"(min-width: 500px) 500px, 100vw"}]},"width":500,"height":500}},"publicURL":"/static/2119932e4dcc6609db1aab6b2f265787/DI_thum.png"}}}}]}},"pageContext":{"slug":"/Dependency Injection/"}},"staticQueryHashes":[]}